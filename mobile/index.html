<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Scully 0.0.86">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Ledge</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/svg+xml" href="ledge.svg">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<!--  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet">-->
<!--  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">-->
<link rel="stylesheet" href="styles.bf9c277d5441b039e249.css"><style>.button-logo[_ngcontent-jns-c76]{margin-left:104px}.button-logo[_ngcontent-jns-c76]   .logo[_ngcontent-jns-c76]{width:148px}</style><style>.cdk-high-contrast-active .mat-toolbar{outline:solid 1px}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%}.mat-toolbar-multiple-rows{min-height:64px}.mat-toolbar-row,.mat-toolbar-single-row{height:64px}@media(max-width: 599px){.mat-toolbar-multiple-rows{min-height:56px}.mat-toolbar-row,.mat-toolbar-single-row{height:56px}}
</style><style>.mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button[disabled],.mat-icon-button[disabled],.mat-stroked-button[disabled],.mat-flat-button[disabled]{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button[disabled]{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab[disabled]{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab[disabled]{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.cdk-high-contrast-active .mat-button-focus-overlay{background-color:#fff}.cdk-high-contrast-black-on-white .mat-button-focus-overlay{background-color:#000}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:block;font-size:inherit;width:2.5em;height:2.5em}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}
</style><style>.mat-menu-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;max-height:calc(100vh - 48px);border-radius:4px;outline:0;min-height:64px}.mat-menu-panel.ng-animating{pointer-events:none}.cdk-high-contrast-active .mat-menu-panel{outline:solid 1px}.mat-menu-content:not(:empty){padding-top:8px;padding-bottom:8px}.mat-menu-item{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;line-height:48px;height:48px;padding:0 16px;text-align:left;text-decoration:none;max-width:100%;position:relative}.mat-menu-item::-moz-focus-inner{border:0}.mat-menu-item[disabled]{cursor:default}[dir=rtl] .mat-menu-item{text-align:right}.mat-menu-item .mat-icon{margin-right:16px;vertical-align:middle}.mat-menu-item .mat-icon svg{vertical-align:top}[dir=rtl] .mat-menu-item .mat-icon{margin-left:16px;margin-right:0}.mat-menu-item[disabled]{pointer-events:none}.cdk-high-contrast-active .mat-menu-item.cdk-program-focused,.cdk-high-contrast-active .mat-menu-item.cdk-keyboard-focused,.cdk-high-contrast-active .mat-menu-item-highlighted{outline:dotted 1px}.mat-menu-item-submenu-trigger{padding-right:32px}.mat-menu-item-submenu-trigger::after{width:0;height:0;border-style:solid;border-width:5px 0 5px 5px;border-color:transparent transparent transparent currentColor;content:"";display:inline-block;position:absolute;top:50%;right:16px;transform:translateY(-50%)}[dir=rtl] .mat-menu-item-submenu-trigger{padding-right:16px;padding-left:32px}[dir=rtl] .mat-menu-item-submenu-trigger::after{right:auto;left:16px;transform:rotateY(180deg) translateY(-50%)}button.mat-menu-item{width:100%}.mat-menu-item .mat-menu-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}
</style><style>.mat-icon{background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}
</style><style></style><style>[_nghost-jns-c47]{position:relative;box-sizing:border-box}@media screen and (max-width:1024px){.left-drawer[_ngcontent-jns-c47]{display:none}}.no-toc-markdown[_ngcontent-jns-c47]{width:95%;margin:1em auto 0}.sticky[_ngcontent-jns-c47]{position:fixed;overflow-y:scroll;z-index:10;top:0;height:100vh}.scroll-to-top[_ngcontent-jns-c47]{position:fixed;bottom:64px;right:32px;opacity:0;transition:all .2s ease-in-out}.show-scrollTop[_ngcontent-jns-c47]{opacity:1;z-index:999;transition:all .2s ease-in-out}</style><style>.ledge-render[_ngcontent-jns-c37]{width:100%}.render-item[_ngcontent-jns-c37]{padding:0 2em}.card-column[_ngcontent-jns-c37]{padding:0 .5rem!important}ul[_ngcontent-jns-c37]{padding-left:1em}ul[_ngcontent-jns-c37]   li[_ngcontent-jns-c37]{white-space:pre-wrap}ul[_ngcontent-jns-c37]   li.task-list-item[_ngcontent-jns-c37]{list-style:none}ul[_ngcontent-jns-c37]   li.task-list-item[_ngcontent-jns-c37]   input[type=checkbox][_ngcontent-jns-c37]{margin:0 .2em .25em -1.6em;vertical-align:middle}.step-line[_ngcontent-jns-c37]{display:flex}</style><script>window['ScullyIO']='generated';</script></head>
<body class="mat-typography" scully-version="0.0.86">
  <!--[if IE]>
  <div id="browser-warning" style="display: none;">
    <h2 class="title">抱歉，您的浏览器版本过低，请先升级到 <a href="https://www.microsoft.com/en-us/edge">Microsoft Edge</a></h2>
    <p>欢迎帮助我们修复这个 <a href="https://github.com/phodal/ledge/">Issue</a></p>
  </div>
  <![endif]-->

  <app-root id="app" _nghost-jns-c76="" ng-version="9.0.5"><mat-toolbar _ngcontent-jns-c76="" color="accent" class="mat-toolbar mat-accent mat-toolbar-multiple-rows"><mat-toolbar-row _ngcontent-jns-c76="" class="mat-toolbar-row"><button _ngcontent-jns-c76="" mat-button="" routerlink="/home" class="mat-focus-indicator button-logo mat-button mat-button-base" tabindex="0"><span class="mat-button-wrapper"><img _ngcontent-jns-c76="" src="/assets/images/logo.svg" alt="logo" class="logo"></span><div matripple="" class="mat-ripple mat-button-ripple"></div><div class="mat-button-focus-overlay"></div></button><span _ngcontent-jns-c76="" class="spacer"></span><div _ngcontent-jns-c76="" class="right"><button _ngcontent-jns-c76="" mat-button="" routerlink="/home" routerlinkactive="active" class="mat-focus-indicator mat-button mat-button-base" tabindex="0"><span class="mat-button-wrapper">首页</span><div matripple="" class="mat-ripple mat-button-ripple"></div><div class="mat-button-focus-overlay"></div></button><button _ngcontent-jns-c76="" mat-button="" routerlink="/case-study" routerlinkactive="active" class="mat-focus-indicator mat-button mat-button-base" tabindex="0"><span class="mat-button-wrapper">案例学习</span><div matripple="" class="mat-ripple mat-button-ripple"></div><div class="mat-button-focus-overlay"></div></button><button _ngcontent-jns-c76="" mat-button="" routerlink="/pattern" routerlinkactive="active" class="mat-focus-indicator mat-button mat-button-base" tabindex="0"><span class="mat-button-wrapper">模式与原则</span><div matripple="" class="mat-ripple mat-button-ripple"></div><div class="mat-button-focus-overlay"></div></button><button _ngcontent-jns-c76="" mat-button="" routerlink="/practise" routerlinkactive="active" class="mat-focus-indicator mat-button mat-button-base" tabindex="0"><span class="mat-button-wrapper">最佳实践</span><div matripple="" class="mat-ripple mat-button-ripple"></div><div class="mat-button-focus-overlay"></div></button><button _ngcontent-jns-c76="" mat-button="" routerlink="/manual" routerlinkactive="active" class="mat-focus-indicator mat-button mat-button-base" tabindex="0"><span class="mat-button-wrapper">操作手册</span><div matripple="" class="mat-ripple mat-button-ripple"></div><div class="mat-button-focus-overlay"></div></button><button _ngcontent-jns-c76="" mat-button="" routerlink="/solution" routerlinkactive="active" class="mat-focus-indicator mat-button mat-button-base" tabindex="0"><span class="mat-button-wrapper">解决方案</span><div matripple="" class="mat-ripple mat-button-ripple"></div><div class="mat-button-focus-overlay"></div></button><button _ngcontent-jns-c76="" mat-button="" routerlink="/think-tank" routerlinkactive="active" class="mat-focus-indicator mat-button mat-button-base" tabindex="0"><span class="mat-button-wrapper">智库</span><div matripple="" class="mat-ripple mat-button-ripple"></div><div class="mat-button-focus-overlay"></div></button><mat-menu _ngcontent-jns-c76="" backdropclass="nav-menu-wrapper" class="ng-tns-c74-0"><!----></mat-menu><button _ngcontent-jns-c76="" aria-haspopup="true" mat-button="" class="mat-focus-indicator mat-menu-trigger mat-button mat-button-base"><span class="mat-button-wrapper"> 资源<mat-icon _ngcontent-jns-c76="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true">arrow_drop_down</mat-icon></span><div matripple="" class="mat-ripple mat-button-ripple"></div><div class="mat-button-focus-overlay"></div></button><!----><mat-menu _ngcontent-jns-c76="" backdropclass="nav-menu-wrapper" class="ng-tns-c74-1"><!----></mat-menu><button _ngcontent-jns-c76="" aria-haspopup="true" mat-button="" class="mat-focus-indicator mat-menu-trigger mat-button mat-button-base"><span class="mat-button-wrapper"> 工具<mat-icon _ngcontent-jns-c76="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true">arrow_drop_down</mat-icon></span><div matripple="" class="mat-ripple mat-button-ripple"></div><div class="mat-button-focus-overlay"></div></button><!----></div></mat-toolbar-row></mat-toolbar><router-outlet _ngcontent-jns-c76=""></router-outlet><app-mobile _nghost-jns-c60="" class="ng-star-inserted"><component-markdown-render _ngcontent-jns-c60="" showtoc="true" _nghost-jns-c47=""><div _ngcontent-jns-c47="" class="ng-star-inserted"><div _ngcontent-jns-c47="" class="markdown-toc"><div _ngcontent-jns-c47="" class="left-drawer"><div _ngcontent-jns-c47="" class="toc"><ul _ngcontent-jns-c47=""><li><a class="level_1" id="menu-mobile-android" href="/mobile#mobile-android" title="Mobile" android="">Mobile Android</a><ul><li><a class="level_2" id="menu-移动中台" href="/mobile#移动中台" title="移动中台">移动中台</a><ul><li><a class="level_3" id="menu-单体应用" href="/mobile#单体应用" title="单体应用">单体应用</a></li><li><a class="level_3" id="menu-模块化应用" href="/mobile#模块化应用" title="模块化应用">模块化应用</a></li><li><a class="level_3" id="menu-容器化应用" href="/mobile#容器化应用" title="容器化应用">容器化应用</a></li></ul></li><li><a class="level_2" id="menu-持续集成" href="/mobile#持续集成" title="持续集成">持续集成</a></li><li><a class="level_2" id="menu-测试" href="/mobile#测试" title="测试">测试</a><ul><li><a class="level_3" id="menu-单元测试（小型测试）" href="/mobile#单元测试（小型测试）" title="单元测试（小型测试）">单元测试（小型测试）</a><ul><li><a class="level_4" id="menu-本地单元测试" href="/mobile#本地单元测试" title="本地单元测试">本地单元测试</a></li><li><a class="level_4" id="menu-设置测试环境" href="/mobile#设置测试环境" title="设置测试环境">设置测试环境</a></li></ul></li><li><a class="level_3" id="menu-集成测试（中型测试）" href="/mobile#集成测试（中型测试）" title="集成测试（中型测试）">集成测试（中型测试）</a></li><li><a class="level_3" id="menu-ui-测试（大型测试）" href="/mobile#ui-测试（大型测试）" title="UI" 测试（大型测试）="">UI 测试（大型测试）</a></li></ul></li><li><a class="level_2" id="menu-发布" href="/mobile#发布" title="发布">发布</a></li><li><a class="level_2" id="menu-apm" href="/mobile#apm" title="APM">APM</a></li></ul></li></ul></div></div><div _ngcontent-jns-c47="" class="right-content"><ledge-render _ngcontent-jns-c47="" _nghost-jns-c37="" class="ng-star-inserted"><div _ngcontent-jns-c37="" class="ledge-render"><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><h1 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="mobile-android">Mobile Android</h1><!----><!----><!----><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><h2 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="移动中台">移动中台</h2><!----><!----><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><!----><h3 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="单体应用">单体应用</h3><!----><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><!----><h3 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="模块化应用">模块化应用</h3><!----><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><!----><h3 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="容器化应用">容器化应用</h3><!----><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><h2 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="持续集成">持续集成</h2><!----><!----><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37="">独立编译</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37="">联合打包</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><h2 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="测试">测试</h2><!----><!----><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37=""><img src="https://developer.android.google.cn/images/training/testing/pyramid_2x.png" alt="测试金字塔，显示了应用的测试套件应包含的三类测试" title="测试金字塔"></p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37="">沿着金字塔逐级向上，从小型测试到大型测试，各类测试的保真度逐级提高，但维护和调试工作所需的执行时间和工作量也逐级增加。因此，您编写的单元测试应多于集成测试，集成测试应多于端到端测试。虽然各类测试的比例可能会因应用的用例不同而异，但我们通常建议各类测试所占比例如下：<strong>小型测试占 70%，中型测试占 20%，大型测试占 10%</strong>。</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><!----><h3 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="单元测试（小型测试）">单元测试（小型测试）</h3><!----><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37=""><strong>用于验证应用的行为，一次验证一个类。</strong></p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37=""><strong>原则（<code>F.I.R.S.T</code>）</strong></p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37=""><strong>F</strong>ast(快)，单元测试要运行的足够快，单个测试方法一般要立即（一秒之内）给出结果。<br><strong>I</strong>dependent(独立)，测试方法之间不要有依赖（先执行某个测试方法，再执行另一个测试方法才能通过）。<br><strong>R</strong>epeatable（重复），可以在本地或 CI 不同环境（机器上）上反复执行，不会出现不稳定的情况。<br><strong>S</strong>elf-Validating（自验证），单元测试必须包含足够多的断言进行自我验证。<br><strong>T</strong>imely（及时），理想情况下应测试先行，至少保证单元测试应该和实现代码一起及时完成并提交。</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37="">除此之外，测试代码应该具备最好的<strong>可读性</strong>和最少的<strong>维护代价</strong>，绝大多数情况下写测试应该就像用<strong>领域特定语言描述一个事实</strong>，甚至<strong>不用经过仔细地思考</strong>。</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><!----><!----><h4 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="本地单元测试">本地单元测试</h4><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37=""><strong>当需要更快地运行测试而不需要与在真实设备上运行测试关联的保真度和置信度时，可以使用本地单元测试来验证应用的逻辑。</strong></p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><ul _ngcontent-jns-c37="" class="ng-star-inserted"><li _ngcontent-jns-c37="" class="sub-item ng-star-inserted"><!---->如果测试对<code>Android</code>框架有依赖性（特别是与框架建立复杂交互的测试），则最好使用 <code>Robolectric</code>添加框架依赖项。<!----><!----></li><!----><!----></ul><!----><!----></div><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><blockquote _ngcontent-jns-c37="">例：待测试的类同时依赖<code>Context</code>、<code>Intent</code>、<code>Bundle</code>、<code>Application</code>等<code>Android Framework</code>中的类时，此时我们可以引入<code>Robolectric</code>框架进行本地单元测试的编写。</blockquote></div><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><ul _ngcontent-jns-c37="" class="ng-star-inserted"><li _ngcontent-jns-c37="" class="sub-item ng-star-inserted"><!---->如果测试对<code>Android</code>框架的依赖性极小，或者如果测试仅取决于我们自己应用的对象，则可以使用诸如<code>Mockito</code>之类的模拟框架添加模拟依赖项。(<a href="https://github.com/android/testing-samples/tree/master/unit/BasicUnitAndroidTest">BasicUnitAndroidTest</a>)<!----><!----></li><!----><!----></ul><!----><!----></div><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><blockquote _ngcontent-jns-c37="">例：待测试的类只依赖<code>java api</code>（最理想的情况）,此时对于待测试类所依赖的其他类我们就可以利用<code>Mockito</code>框架 mock 其依赖类，再进行当前类的单元测试编写。(<a href="https://github.com/android/testing-samples/blob/master/unit/BasicSample/app/src/test/java/com/example/android/testing/unittesting/BasicSample/EmailValidatorTest.java">EmailValidatorTest</a>)</blockquote></div><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><blockquote _ngcontent-jns-c37="">例：待测试的类除了依赖<code>java api</code>外仅依赖<code>Android Framework</code>中<code>Context</code>这个类,此时我们就可以利用<code>Mockito</code>框架<code>mock</code> <code>Context</code>类，再进行当前类的单元测试编写。(<a href="https://github.com/android/testing-samples/blob/master/unit/BasicSample/app/src/test/java/com/example/android/testing/unittesting/BasicSample/SharedPreferencesHelperTest.java">SharedPreferencesHelperTest</a>)</blockquote></div><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><!----><!----><h4 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="设置测试环境">设置测试环境</h4><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37="">在<code>Android Studio</code>项目中，本地单元测试的源文件存储在<code>module-name/src/test/java/</code>中。</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37="">在模块的顶级<code>build.gradle</code>文件中，将以下库指定为依赖项：</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><pre _ngcontent-jns-c37="" class=" language-groovy">        <code _ngcontent-jns-c37="" class=" language-groovy">    dependencies <span class="token punctuation">{</span>
        <span class="token comment">// Required -- JUnit 4 framework</span>
        testImplementation <span class="token string gstring">"junit:junit:<span class="token expression"><span class="token punctuation">$</span>junitVersion</span>"</span>
        <span class="token comment">// Optional -- Mockito framework</span>
        testImplementation <span class="token string gstring">"org.mockito:mockito-core:<span class="token expression"><span class="token punctuation">$</span>mockitoCoreVersion</span>"</span>

        <span class="token comment">// Optional -- Robolectric environment</span>
       testImplementation <span class="token string gstring">"androidx.test:core:<span class="token expression"><span class="token punctuation">$</span>xcoreVersion</span>"</span>
       testImplementation <span class="token string gstring">"androidx.test.ext:junit:<span class="token expression"><span class="token punctuation">$</span>extJunitVersion</span>"</span>
       testImplementation <span class="token string gstring">"org.robolectric:robolectric:<span class="token expression"><span class="token punctuation">$</span>robolectricVersion</span>"</span>
    <span class="token punctuation">}</span></code>
      </pre></div><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37="">如果单元测试依赖于资源，需要在 module 的 build.gradle 文件中启用<code>includeAndroidResources</code>选项。然后，单元测试可以访问编译版本的资源，从而使测试更快速且更准确地运行。</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><pre _ngcontent-jns-c37="" class=" language-groovy">        <code _ngcontent-jns-c37="" class=" language-groovy">    android <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>

        testOptions <span class="token punctuation">{</span>
            unitTests <span class="token punctuation">{</span>
                includeAndroidResources <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code>
      </pre></div><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><pre _ngcontent-jns-c37="" class=" language-java">        <code _ngcontent-jns-c37="" class=" language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">AndroidJUnit4</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Config</span><span class="token punctuation">(</span>manifest <span class="token operator">=</span> <span class="token class-name">Config</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">PeopleDaoTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> lateinit <span class="token keyword">var</span> database<span class="token operator">:</span> <span class="token class-name">PeopleDatabase</span>

    <span class="token keyword">private</span> lateinit <span class="token keyword">var</span> peopleDao<span class="token operator">:</span> <span class="token class-name">PeopleDao</span>

    <span class="token annotation punctuation">@Before</span>
    fun `create db`<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        database <span class="token operator">=</span> <span class="token class-name">Room</span><span class="token punctuation">.</span><span class="token function">inMemoryDatabaseBuilder</span><span class="token punctuation">(</span>
            <span class="token class-name">ApplicationProvider</span><span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">PeopleDatabase</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">allowMainThreadQueries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        peopleDao <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">peopleDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    fun `should <span class="token keyword">return</span> empty list when getPeople without inserted data`<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        val result <span class="token operator">=</span> peopleDao<span class="token punctuation">.</span><span class="token function">getPeople</span><span class="token punctuation">(</span>pageId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token function">assertThat</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span></code>
      </pre></div><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37="">如果单元测试包含异步操作时，可以使用 <a href="https://github.com/awaitility/awaitility">awaitility 库</a>进行测试；当使用<a href="https://github.com/ReactiveX/RxJava">RxJava</a>响应式编程库时，可以自定义 rule：</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><pre _ngcontent-jns-c37="" class=" language-java">        <code _ngcontent-jns-c37="" class=" language-java"><span class="token keyword">class</span> <span class="token class-name">RxJavaRule</span> <span class="token operator">:</span> <span class="token class-name">TestWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    override fun <span class="token function">starting</span><span class="token punctuation">(</span>description<span class="token operator">:</span> <span class="token class-name">Description</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">starting</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span>

        <span class="token class-name">RxJavaPlugins</span><span class="token punctuation">.</span>setIoSchedulerHandler <span class="token punctuation">{</span>
            <span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">trampoline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">RxJavaPlugins</span><span class="token punctuation">.</span>setNewThreadSchedulerHandler <span class="token punctuation">{</span>
            <span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">trampoline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">RxJavaPlugins</span><span class="token punctuation">.</span>setComputationSchedulerHandler <span class="token punctuation">{</span>
            <span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">trampoline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">RxAndroidPlugins</span><span class="token punctuation">.</span>setMainThreadSchedulerHandler <span class="token punctuation">{</span>
            <span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">trampoline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">RxAndroidPlugins</span><span class="token punctuation">.</span>setInitMainThreadSchedulerHandler <span class="token punctuation">{</span>
            <span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">trampoline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    override fun <span class="token function">finished</span><span class="token punctuation">(</span>description<span class="token operator">:</span> <span class="token class-name">Description</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">finished</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span>

        <span class="token class-name">RxJavaPlugins</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token class-name">RxAndroidPlugins</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code>
      </pre></div><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37=""><code>TestScheduler</code>中<code>triggerActions</code>的使用。</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><pre _ngcontent-jns-c37="" class=" language-java">        <code _ngcontent-jns-c37="" class=" language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">JUnit4</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">FilmViewModelTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@get</span><span class="token operator">:</span><span class="token class-name">Rule</span>
    val instantTaskExecutorRule <span class="token operator">=</span> <span class="token class-name">InstantTaskExecutorRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@get</span><span class="token operator">:</span><span class="token class-name">Rule</span>
    val rxJavaRule <span class="token operator">=</span> <span class="token class-name">RxJavaRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">private</span> val repository <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">Repository</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>

    <span class="token keyword">private</span> val testScheduler <span class="token operator">=</span> <span class="token class-name">TestScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">private</span> lateinit <span class="token keyword">var</span> viewModel<span class="token operator">:</span> <span class="token class-name">FilmViewModel</span>

    <span class="token annotation punctuation">@Before</span>
    fun <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        viewModel <span class="token operator">=</span> <span class="token class-name">FilmViewModel</span><span class="token punctuation">(</span>repository<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    fun `should <span class="token keyword">return</span> <span class="token boolean">true</span> when loadFilms is loading`<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        `when`<span class="token punctuation">(</span>repository<span class="token punctuation">.</span><span class="token function">getPopularFilms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
            <span class="token class-name">Single</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>emptyList<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Film</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">subscribeOn</span><span class="token punctuation">(</span>testScheduler<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>

        viewModel<span class="token punctuation">.</span><span class="token function">loadFilms</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

        <span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token function">getValue</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>isLoading<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        testScheduler<span class="token punctuation">.</span><span class="token function">triggerActions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token function">getValue</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>isLoading<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isFalse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    fun `should <span class="token keyword">return</span> films list when loadFilms successful`<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        `when`<span class="token punctuation">(</span>repository<span class="token punctuation">.</span><span class="token function">getPopularFilms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
            <span class="token class-name">Single</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>
                <span class="token function">listOf</span><span class="token punctuation">(</span>
                    <span class="token class-name">Film</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribeOn</span><span class="token punctuation">(</span>testScheduler<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>

        viewModel<span class="token punctuation">.</span><span class="token function">loadFilms</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

        <span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token function">getValue</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>films<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        testScheduler<span class="token punctuation">.</span><span class="token function">triggerActions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token function">getValue</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>films<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token function">getValue</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>films<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code>
      </pre></div><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37=""><code>TestSubscriber</code>的使用。</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><pre _ngcontent-jns-c37="" class=" language-java">        <code _ngcontent-jns-c37="" class=" language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">JUnit4</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">WebServiceTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> lateinit <span class="token keyword">var</span> webService<span class="token operator">:</span> <span class="token class-name">WebService</span>

    <span class="token keyword">private</span> lateinit <span class="token keyword">var</span> mockWebServer<span class="token operator">:</span> <span class="token class-name">MockWebServer</span>

    <span class="token annotation punctuation">@get</span><span class="token operator">:</span><span class="token class-name">Rule</span>
    val instantExecutorRule <span class="token operator">=</span> <span class="token class-name">InstantTaskExecutorRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token annotation punctuation">@Before</span>
    fun `start service`<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mockWebServer <span class="token operator">=</span> <span class="token class-name">MockWebServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        webService <span class="token operator">=</span> <span class="token class-name">Retrofit</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span>mockWebServer<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addConverterFactory</span><span class="token punctuation">(</span><span class="token class-name">GsonConverterFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addCallAdapterFactory</span><span class="token punctuation">(</span><span class="token class-name">RxJava2CallAdapterFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">WebService</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    fun `should <span class="token keyword">return</span> fim list when getFilms successful`<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>webService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token function">enqueueResponse</span><span class="token punctuation">(</span><span class="token string">"popular_films.json"</span><span class="token punctuation">)</span>

        val testObserver <span class="token operator">=</span> webService<span class="token punctuation">.</span><span class="token function">getPopularFilms</span><span class="token punctuation">(</span>page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>map <span class="token punctuation">{</span>
                it<span class="token punctuation">.</span>data
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        testObserver<span class="token punctuation">.</span><span class="token function">assertNoErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        testObserver<span class="token punctuation">.</span><span class="token function">assertValueCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        testObserver<span class="token punctuation">.</span>assertValue <span class="token punctuation">{</span>
            <span class="token function">assertThat</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">assertThat</span><span class="token punctuation">(</span>it<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">297761</span><span class="token punctuation">)</span>
            <span class="token function">assertThat</span><span class="token punctuation">(</span>it<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">324668</span><span class="token punctuation">)</span>
            it<span class="token punctuation">.</span>size <span class="token operator">==</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
        testObserver<span class="token punctuation">.</span><span class="token function">assertComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        testObserver<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    fun `stop service`<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mockWebServer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> fun <span class="token function">enqueueResponse</span><span class="token punctuation">(</span>fileName<span class="token operator">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        val inputStream <span class="token operator">=</span> javaClass<span class="token punctuation">.</span>classLoader<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"api-response/$fileName"</span><span class="token punctuation">)</span>
            <span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword">return</span>
        val source <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        val mockResponse <span class="token operator">=</span> <span class="token class-name">MockResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        mockWebServer<span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span>
            mockResponse
                <span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">readString</span><span class="token punctuation">(</span><span class="token class-name">Charsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code>
      </pre></div><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37="">插桩单元测试</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><!----><h3 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="集成测试（中型测试）">集成测试（中型测试）</h3><!----><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><blockquote _ngcontent-jns-c37="">四大组件（Activity、Service、BroadcastReceiver、ContentProvider）测试</blockquote></div><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><!----><h3 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="ui-测试（大型测试）">UI 测试（大型测试）</h3><!----><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><ul _ngcontent-jns-c37="" class="ng-star-inserted"><li _ngcontent-jns-c37="" class="sub-item ng-star-inserted"><!---->Espresso<!----><!----></li><li _ngcontent-jns-c37="" class="sub-item ng-star-inserted"><!---->UIAutomator<!----><!----></li><!----><!----></ul><!----><!----></div><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><h2 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="发布">发布</h2><!----><!----><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37="">热更新与热修复</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><p _ngcontent-jns-c37="">灰度发布</p></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div _ngcontent-jns-c37="" class="markdown render-item ng-star-inserted"><div _ngcontent-jns-c37=""><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div _ngcontent-jns-c37="" class="ng-star-inserted"><!----><h2 _ngcontent-jns-c37="" class="ledge-heading ng-star-inserted" id="apm">APM</h2><!----><!----><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----></div></div><!----></div></ledge-render><!----></div></div></div><!----><!----><div _ngcontent-jns-c47="" class="scroll-to-top ng-star-inserted"><button _ngcontent-jns-c47="" mat-fab="" aria-label="home" class="mat-focus-indicator mat-fab mat-button-base mat-accent"><span class="mat-button-wrapper"><mat-icon _ngcontent-jns-c47="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true">arrow_upward</mat-icon></span><div matripple="" class="mat-ripple mat-button-ripple mat-button-ripple-round"></div><div class="mat-button-focus-overlay"></div></button></div><!----></component-markdown-render></app-mobile><!----></app-root>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-77YVCJP4T6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-77YVCJP4T6');
</script>
<script id="ScullyIO-transfer-state"></script><script src="runtime-es2015.176e633f812bbfb24a51.js" type="module"></script><script src="runtime-es5.176e633f812bbfb24a51.js" nomodule="" defer=""></script><script src="polyfills-es5.d03c639b22d15463ae23.js" nomodule="" defer=""></script><script src="polyfills-es2015.9437cd1c9e700d460152.js" type="module"></script><script src="scripts.d87278c272c84070759a.js" defer=""></script><script src="main-es2015.81851630eb2616af5aea.js" type="module"></script><script src="main-es5.81851630eb2616af5aea.js" nomodule="" defer=""></script>

</body></html>